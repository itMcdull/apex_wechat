const mp=require("../../miniprogram-render/index"),{Event:Event,cache:cache,tool:tool}=mp.$$adapter;function isEqual(t,e){if("number"==typeof t&&"number"==typeof e)return parseInt(1e3*t,10)===parseInt(1e3*e,10);if("object"==typeof t&&"object"==typeof e){if(null===t||null===e)return t===e;const o=Array.isArray(t),n=Array.isArray(e);if(o&&n){if(t.length!==e.length)return!1;for(let o=0,n=t.length;o<n;o++)if(!isEqual(t[o],e[o]))return!1;return!0}if(!n&&!n){const o=Object.keys(t),n=Object.keys(e);if(o.length!==n.length)return!1;for(const n of o)if(!isEqual(t[n],e[n]))return!1;return!0}}return t===e}function checkComponentAttr({props:t=[],propsVal:e},o,n,s,i){if(t.length)for(const o of t){let t=n.getAttribute(o);if(void 0===t&&(t=n.getAttribute(tool.toDash(o))),void 0===t&&e&&(t=e[o]),t=void 0!==t?t:null,"string"==typeof t){try{const e=JSON.parse(t);"object"==typeof e&&(t=e)}catch(t){}"string"==typeof t&&(t="false"!==t&&t)}const d=tool.toCamel(o);i&&isEqual(i[d],t)||(s[d]=t)}const d=n.id;i&&i.id===d||(s.id=d);const a=`wx-comp-${o} node-${n.$$nodeId} ${n.className||""}`;i&&i.className===a||(s.className=a);const r=n.style.cssText;i&&i.style===r||(s.style=r);const l=n.childNodes.map(t=>{const e=t.$$domInfo;return{slot:e.slot,nodeId:e.nodeId,pageId:e.pageId,id:e.id,className:"element"===e.type?`h5-${e.tagName} node-${e.nodeId} ${e.className||""}`:"",style:e.style}}).filter(t=>!!t.slot);s.hasSlots=l.length,s.slots=l}function setData(t,e){tool.setData?tool.setData(t,e):t.setData(e)}Component({properties:{kboneCustomComponentName:{type:String,value:""}},options:{addGlobalClass:!0,virtualHost:!0},attached(){const t=this.dataset.privateNodeId,e=this.dataset.privatePageId,o={};this.nodeId=t,this.pageId=e,this.domNode=cache.getNode(e,t);const n=cache.getConfig();this.compConfig=n.runtime&&n.runtime.usingComponents&&n.runtime.usingComponents[this.domNode.behavior]||{},this.onSelfNodeUpdate=tool.throttle(this.onSelfNodeUpdate.bind(this)),this.domNode.$$clearEvent("$$domNodeUpdate",{$$namespace:"proxy"}),this.domNode.addEventListener("$$domNodeUpdate",this.onSelfNodeUpdate,{$$namespace:"proxy"});const{events:s=[]}=this.compConfig;if(s.length)for(const t of s)this["on"+t]=e=>this.callSimpleEvent(t,e);checkComponentAttr(this.compConfig,this.domNode.behavior,this.domNode,o),Object.keys(o).length&&setData(this,o),this.domNode._wxCustomComponent=this.selectComponent(".node-"+this.domNode.$$nodeId)},detached(){this.nodeId=null,this.pageId=null,this.domNode._wxCustomComponent=null,this.domNode=null},methods:{onSelfNodeUpdate(){if(!this.pageId||!this.nodeId)return;const t={};checkComponentAttr(this.compConfig,this.domNode.behavior,this.domNode,t,this.data),setData(this,t),this.domNode._wxCustomComponent=this.selectComponent(".node-"+this.domNode.$$nodeId)},callSimpleEvent(t,e){const o=this.domNode;o&&o.$$trigger(t,{event:new Event({name:t,target:o,eventPhase:Event.AT_TARGET,detail:e&&e.detail}),currentTarget:o})}}});